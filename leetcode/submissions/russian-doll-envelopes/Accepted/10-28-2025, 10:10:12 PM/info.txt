{"id":1814694784,"question_id":354,"lang":"cpp","lang_name":"C++","time":"2 weeks, 6 days","timestamp":1761714612,"status":10,"status_display":"Accepted","runtime":"327 ms","url":"/submissions/detail/1814694784/","is_pending":"Not Pending","title":"Russian Doll Envelopes","memory":"253.5 MB","code":"class Solution {\npublic:\n    template<class T>\n    struct SegTree {\n        static constexpr T unit = 0;\n        T f(T a, T b) { return max(a, b); }\n        vector<T> tree; int n;\n        SegTree (int i = 0, T def = unit) : tree(2*i, def), n(i) {}\n        void update(int pos, T val) {\n            for (tree[pos += n] = val; pos /= 2;)\n                tree[pos] = f(tree[pos * 2], tree[pos * 2 + 1]);\n        }\n        T query(int b, int e) {\n            T ra = unit, rb = unit;\n            for (b += n, e += n; b < e; b /= 2, e /= 2) {\n                if (b % 2) ra = f(ra, tree[b++]);\n                if (e % 2) rb = f(tree[--e], rb);\n            }\n            return f(ra, rb);\n        }\n    };\n\n    const static int MX = 1e5+1;\n    int maxEnvelopes(vector<vector<int>>& envelopes) {\n        int N = (int)envelopes.size();\n        sort(envelopes.begin(), envelopes.end(), [](const vector<int>& a, \n                const vector<int>&b) {\n            if (a[0] == b[0])\n                return a[1] < b[1];\n            return a[0] < b[0];\n        });\n\n        vector<pair<int, int>> heights;\n        for (int i=0; i<N; i++)\n            heights.push_back({envelopes[i][1], i});\n        sort(heights.begin(), heights.end());\n\n        unordered_map<int, pair<int, int>> h; // {local, global}\n        unordered_map<int, int> minH;\n        for (int i=0; i<N; i++) {\n            if (!minH.count(heights[i].first))\n                minH[heights[i].first] = i;\n            h[heights[i].second] = {minH[heights[i].first], i};\n        }\n\n        map<int, vector<int>> w;\n        for (int i=0; i<N; i++)\n            w[envelopes[i][0]].push_back(i);\n        \n        SegTree<int> stree(N, 0);\n        for (auto [k, v] : w) {\n            queue<int> upd;\n            for (int i : v) {\n                int val = stree.query(0, h[i].first) + 1;\n                upd.push(val);\n            }\n            for (int i : v) {\n                int val = upd.front();\n                stree.update(h[i].second, val);\n                upd.pop();\n            }\n        }\n        return stree.query(0, N);\n    }\n};","compare_result":"111111111111111111111111111111111111111111111111111111111111111111111111111111111111111","title_slug":"russian-doll-envelopes","has_notes":false,"flag_type":1,"frontend_id":1313}