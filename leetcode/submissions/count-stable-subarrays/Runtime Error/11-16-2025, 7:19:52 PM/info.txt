{"id":1831884596,"question_id":4110,"lang":"cpp","lang_name":"C++","time":"1 day, 22 hours","timestamp":1763349592,"status":15,"status_display":"Runtime Error","runtime":"N/A","url":"/submissions/detail/1831884596/","is_pending":"Not Pending","title":"Count Stable Subarrays","memory":"N/A","code":"class Solution {\npublic:\n    template<class T>\n    struct SegTree {\n        static constexpr T unit = 0;\n        T f(T a, T b) { return a + b; }\n        vector<T> tree; int n;\n        SegTree (int i = 0, T def = unit) : tree(2*i, def), n(i) {}\n        void update(int pos, T val) {\n            for (tree[pos += n] = val; pos /= 2;)\n                tree[pos] = f(tree[pos * 2], tree[pos * 2 + 1]);\n        }\n        T query(int b, int e) {\n            e++;\n            T ra = unit, rb = unit;\n            for (b += n, e += n; b < e; b /= 2, e /= 2) {\n                if (b % 2) ra = f(ra, tree[b++]);\n                if (e % 2) rb = f(tree[--e], rb);\n            }\n            return f(ra, rb);\n        }\n    };\n    \n    template<class T>\n    T firstTrue(T l, T r, function<bool(T)> f) {\n        r++;\n        while (l < r) {\n            T mid = l + (r - l) / 2;\n            if (f(mid)) r = mid;\n            else l = mid + 1;\n        }\n        return l;\n    }\n \n    vector<long long> countStableSubarrays(vector<int>& nums, vector<vector<int>>& queries) {\n        int N = (int)nums.size();\n        SegTree<int> st(N, 0);\n        vector<pair<int, int>> pq;\n        for (int i=0; i<N; i++) {\n            int l = i;\n            while (i+1<N && nums[i] <= nums[i+1]) \n                i++;\n            int hand = (i - l + 1) + 1;\n            st.update(l, hand*(hand-1)/2);\n            pq.push_back({l, i});\n        }\n\n        vector<long long> ans;\n        int M = (int)pq.size();\n        for (auto q : queries) {\n            int l = q[0], r = q[1];\n            int lidx = firstTrue<int>(0, M-1, [&](int k) {\n                return l <= pq[k].second;\n            });\n            int ridx = firstTrue<int>(0, M-1, [&](int k) {\n                return pq[k].second >= r;\n            });\n            if (lidx >= 0 && lidx < M && ridx >= 0 && ridx < M &&\n                lidx == ridx &&\n                l > pq[lidx].first &&     \n                r < pq[lidx].second) {    \n                long long len = r - l + 1;\n                ans.push_back(len * (len + 1LL) / 2);\n                continue;\n            }\n\n            int val = st.query(l, r);   \n            if (lidx >= 0 && lidx < M && (l <= pq[lidx].second && l > pq[lidx].first)) {\n                int hand = (pq[lidx].second - l + 1) + 1;\n                val += hand*(hand-1)/2;\n            }\n\n            if (ridx >= 0 && ridx < M && (r < pq[ridx].second && r >= pq[ridx].first)) {\n                int hand1 = (pq[ridx].second - pq[ridx].first + 1) + 1;\n                val -= hand1*(hand1-1)/2;\n                \n                int hand2 = (r - pq[ridx].first + 1) + 1;\n                val += hand2*(hand2-1)/2;\n            }\n            ans.push_back(val);\n        }\n        return ans;\n    }\n};","compare_result":"111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000000000000000000","title_slug":"count-stable-subarrays","has_notes":false,"flag_type":1,"frontend_id":1366}